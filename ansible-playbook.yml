# ---
# - name: Deploy Inventoware App
#   hosts: all
#   become: yes
#   tasks:
#     - name: Install Python3 and pip
#       apt:
#         name:
#           - python3
#           - python3-pip
#         state: present
#       when: ansible_os_family == 'Debian'

#     - name: Install requirements
#       pip:
#         requirements: requirements.txt

#     - name: Copy app files
#       copy:
#         src: ./
#         dest: /app/

#     - name: Run the app
#       shell: |
#         cd /app
#         nohup flask run --host=0.0.0.0 &
#       args:
#         executable: /bin/bash

---
- name: Deploy Inventoware App
  hosts: all
  become: yes

  tasks:
    - name: Install Python3 and pip (Debian/Ubuntu)
      apt:
        name:
          - python3
          - python3-pip
        state: present
      when: ansible_os_family == 'Debian'

    - name: Ensure target directory exists on remote
      file:
        path: /opt/inventoware
        state: directory
        mode: '0755'

    - name: Copy project files to remote /opt/inventoware
      copy:
        src: ./
        dest: /opt/inventoware/
        mode: preserve

    - name: Install Python dependencies from requirements.txt
      shell: /usr/bin/pip3 install -r /opt/inventoware/requirements.txt
      args:
        executable: /bin/bash

    - name: Run the Flask app using python3 (not flask run)
      shell: |
        cd /opt/inventoware
        nohup python3 app.py > app.log 2>&1 &
      args:
        executable: /bin/bash
